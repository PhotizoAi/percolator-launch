FROM node:22-slim

WORKDIR /app

# Install exactly what sim-service needs (bypass pnpm workspace/NODE_ENV issues)
RUN npm install -g tsx && \
    npm install --save \
      dotenv \
      @solana/web3.js \
      @solana/spl-token \
      bs58

# Copy source
COPY packages/core/ packages/core/
COPY services/sim-oracle.ts services/sim-bots.ts services/sim-service.ts services/
COPY config/sim-markets.json config/

EXPOSE 3001

CMD ["npx", "tsx", "services/sim-service.ts"]
